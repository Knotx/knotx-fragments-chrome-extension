<!--
  Copyright (C) 2019 Knot.x Project

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <title>Knot.x Functional Test: Payments</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="http://cognifide.com/favicon.ico?v=2"/>
  <link href="https://bootswatch.com/4/simplex/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="jumbotron">
        <h2>
          Hello Knot.x - a reactive integration framework!
        </h2>
        <p>
          This page combines dynamic data with a template. A template may consist of many
          independent
          fragments defining the data they require. Dynamic data may come from external web APIs,
          databases etc.
        </p>
        <p>
          <a class="btn btn-primary btn-large"
             href="https://github.com/Knotx/knotx">Learn more</a>
        </p>
      </div>
    </div>
  </div>
  <div class="row" style="margin-left: 10px">
    <!-- data-knotx-id="73740b5c-11ef-47ef-8d3c-93ab64b4c127" --><script data-knotx-debug="log" data-knotx-id="73740b5c-11ef-47ef-8d3c-93ab64b4c127" type="application/json">{"finishTime":1599057010593,"fragment":{"id":"73740b5c-11ef-47ef-8d3c-93ab64b4c127","type":"snippet","configuration":{"data-knotx-task":"user-task"},"body":"\n      <div>\n        <h2>User details</h2>\n        <p>Id: 3214232</p>\n        <p>Name: Redford</p>\n        <p>Surname: Cornborough</p>\n        <p>Email: rcornborough0@theatlantic.com</p>\n      </div>\n    ","payload":{"fetch-user-info":{"_request":{"type":"HTTP","source":"/service/mock/userInfo.json","metadata":{"headers":{}}},"_response":{"success":true,"metadata":{"statusCode":"200","headers":{"Content-Type":["application/json; charset=UTF-8"],"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":{"id":3214232,"first_name":"Redford","last_name":"Cornborough","email":"rcornborough0@theatlantic.com","gender":"Male","credit_card_type":"visa","credit_card_number":"3562444175055197","user_group":"premium"}}}},"graph":{"finished":1599057010403,"id":"ab0e631c-e738-4481-8ec0-39ec478b2a2a","label":"fetch-user-info","on":{"_success":{"finished":1599057010593,"id":"33a71a29-12f4-447a-a966-af7b83716a9e","label":"te-hbs","on":{},"operation":{"data":{"alias":"te-hbs","actionFactory":"knot","actionConfig":{"address":"knotx.knot.te.handlebars","deliveryOptions":{"sendTimeout":3000},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{},"transition":"_success"},"started":1599057010414,"status":"SUCCESS","subtasks":[],"type":"SINGLE"}},"operation":{"data":{"alias":"fetch-user-info","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/userInfo.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-user-info","logs":{},"doActionLogs":[]},"transition":"_success"},"started":1599057010363,"status":"SUCCESS","subtasks":[],"type":"SINGLE"},"startTime":1599057010363,"status":"SUCCESS"}</script>
    <div>
      <h2>User details</h2>
      <p>Id: 3214232</p>
      <p>Name: Redford</p>
      <p>Surname: Cornborough</p>
      <p>Email: rcornborough0@theatlantic.com</p>
    </div>
    <!-- data-knotx-id="73740b5c-11ef-47ef-8d3c-93ab64b4c127" -->
  </div>
  <div class="row">
    <div class="row" style="margin-left: 10px">
      <!-- data-knotx-id="4991447d-8194-45a0-8cf2-b3f2a7e42d23" --><script data-knotx-debug="log" data-knotx-id="4991447d-8194-45a0-8cf2-b3f2a7e42d23" type="application/json">{"finishTime":1599057010750,"fragment":{"id":"4991447d-8194-45a0-8cf2-b3f2a7e42d23","type":"snippet","configuration":{"data-knotx-task":"payments-task"},"body":"\n        <div>\n          <h2>Payment providers</h2>\n          <ul>\n                        <li>\n              <p>Payment provider: PayPal premium</p>\n              <p>Payment URL: https://paypal-example.com/payment?id=1983247919hv9sa398f</p>\n            </li>\n                        <li>\n              <p>Payment provider: PayU</p>\n              <p>Payment URL: https://payu-example.com/tr?id=afj08aw398gha0we9ge</p>\n            </li>\n                        <li>\n              <p>Payment provider: Credit Card</p>\n              <p>Payment URL: https://cc-example.com/pay/19g8esry9se8rgyse90r8ug4</p>\n            </li>\n                      </ul>\n        </div>\n      ","payload":{"fetch-user-info":{"_request":{"type":"HTTP","source":"/service/mock/userInfo.json","metadata":{"headers":{}}},"_response":{"success":true,"metadata":{"statusCode":"200","headers":{"Content-Type":["application/json; charset=UTF-8"],"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":{"id":3214232,"first_name":"Redford","last_name":"Cornborough","email":"rcornborough0@theatlantic.com","gender":"Male","credit_card_type":"visa","credit_card_number":"3562444175055197","user_group":"premium"}},"fetch-payment-providers":{"_request":{"type":"HTTP","source":"/service/mock/paymentProviders.json","metadata":{"headers":{}}},"_response":{"success":true,"metadata":{"statusCode":"200","headers":{"Content-Type":["application/json; charset=UTF-8"],"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":[{"verified":true,"paymentUrl":"https://paypal-example.com/payment?id=1983247919hv9sa398f","name":"PayPal premium"},{"verified":true,"paymentUrl":"https://payu-example.com/tr?id=afj08aw398gha0we9ge","name":"PayU"},{"verified":true,"paymentUrl":"https://cc-example.com/pay/19g8esry9se8rgyse90r8ug4","name":"Credit Card"}]},"fetch-offers":{"_request":{"type":"HTTP","source":"/service/mock/specialOffers.xml","metadata":{"headers":{}}},"_response":{"success":false,"error":{"code":"500 Internal Server Error","message":"Server Error"},"metadata":{"statusCode":"500","headers":{"Content-Type":["text/html; charset=ISO-8859-1"],"Cache-Control":["must-revalidate,no-cache,no-store"],"Content-Length":["2606"],"Connection":["close"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":null},"fetch-offers-fallback":{"_request":{"type":"HTTP","source":"/service/mock/specialOffers.json","metadata":{"headers":{}}},"_response":{"success":true,"metadata":{"statusCode":"200","headers":{"Content-Type":["application/json; charset=UTF-8"],"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":[{"id":1,"product":"Knot.x Basics - Paperback","price":"$5.92","isbn13":9781234567897},{"id":2,"product":"Hello Knot.x - Paperback","price":"$2.74","isbn13":3456789797812},{"id":3,"product":"Knot.x for Dummies - Paperback","price":"$3.79","isbn13":8123456977897},{"id":4,"product":"Knot.x for Dummies - Ebook","price":"$2.72","isbn13":7897129785634},{"id":5,"product":"Knot.x Starter Kit - Paperback","price":"$2.77","isbn13":8156797892347}]},"notify-analytics":{"_request":{"type":"HTTP","source":"/mock/scenario/analytics","metadata":{"headers":{"content-type":["application/json"]}}},"_response":{"success":false,"error":{"code":"500 Internal Server Error","message":"Server Error"},"metadata":{"statusCode":"500","headers":{"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":null},"notify-analytics-fallback":{"_request":{"type":"HTTP","source":"/service/mock/placeholderFallback.json","metadata":{"headers":{}}},"_response":{"success":true,"metadata":{"statusCode":"200","headers":{"Content-Type":["application/json; charset=UTF-8"],"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]}}},"_result":{"id":999,"method":"Default","price":"$10"}},"fetch-delivery":{"_result":{"fallback":"action ended with _timeout"}}}},"graph":{"finished":1599057010396,"id":"887bde90-0a0b-4146-b5a9-cb587feca607","label":"fetch-user-info","on":{"_success":{"finished":1599057010512,"id":"f8da01dd-2cd4-4e5e-b026-b6fc3e0c865d","label":"composite","on":{"_success":{"finished":1599057010750,"id":"df12f46d-f34b-4c82-896b-c3d6ad4735df","label":"te-pebble","on":{},"operation":{"data":{"alias":"te-pebble","actionFactory":"knot","actionConfig":{"address":"knotx.knot.te.pebble","deliveryOptions":{"sendTimeout":3000},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{},"transition":"_success"},"started":1599057010514,"status":"SUCCESS","subtasks":[],"type":"SINGLE"}},"operation":{"data":{},"factory":"subtasks"},"response":{"errors":[],"log":{},"transition":"_success"},"started":1599057010397,"status":"SUCCESS","subtasks":[{"finished":1599057010415,"id":"e242403c-7a10-498f-a84b-93ab76dc0339","label":"fetch-payment-providers","on":{"_error":{"finished":0,"id":"473d7a6b-f39a-434d-b790-52b9aa11754a","label":"fetch-payment-providers-fallback","on":{},"operation":{"data":{"alias":"fetch-payment-providers-fallback","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/placeholderFallback.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{},"started":0,"status":"UNPROCESSED","subtasks":[],"type":"SINGLE"}},"operation":{"data":{"alias":"fetch-payment-providers","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/paymentProviders.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-payment-providers","logs":{},"doActionLogs":[]},"transition":"_success"},"started":1599057010399,"status":"SUCCESS","subtasks":[],"type":"SINGLE"},{"finished":1599057010423,"id":"3278daa0-f641-4758-80a9-c1c4a3a561c3","label":"fetch-offers","on":{"_error":{"finished":1599057010431,"id":"4eb6140f-20f9-4883-85bf-4457dd660f9a","label":"fetch-offers-fallback","on":{},"operation":{"data":{"alias":"fetch-offers-fallback","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/specialOffers.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-offers-fallback","logs":{},"doActionLogs":[]},"transition":"_success"},"started":1599057010424,"status":"SUCCESS","subtasks":[],"type":"SINGLE"}},"operation":{"data":{"alias":"fetch-offers","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/specialOffers.xml","port":50796},"responseOptions":{"forceJson":true,"predicates":[]},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-offers","logs":{"request":{"path":"/service/mock/specialOffers.xml","requestHeaders":{},"requestBody":""},"response":{"httpVersion":"HTTP_1_1","statusCode":"500","statusMessage":"Server Error","headers":{"Content-Type":["text/html; charset=ISO-8859-1"],"Cache-Control":["must-revalidate,no-cache,no-store"],"Content-Length":["2606"],"Connection":["close"],"Server":["Jetty(9.2.24.v20180105)"]},"trailers":{},"httpMethod":"GET","requestPath":"localhost:50796/service/mock/specialOffers.xml"},"errors":[{"className":"java.io.IOException","message":"The service responded with unsuccessful status code: 500"}]},"doActionLogs":[]},"transition":"_error"},"started":1599057010399,"status":"ERROR","subtasks":[],"type":"SINGLE"},{"finished":1599057010510,"id":"7fc017d5-b437-4cfe-8bd5-3391ff180e51","label":"fetch-delivery-options-cb","on":{"_fallback":{"finished":1599057010511,"id":"6c581f37-b3e4-4bac-8dc6-29e62d3211e9","label":"fetch-delivery-fallback","on":{},"operation":{"data":{"alias":"fetch-delivery-fallback","actionFactory":"inline-payload","actionConfig":{"alias":"fetch-delivery","payload":{"_result":{"fallback":"action ended with _timeout"}},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-delivery-fallback","logs":{},"doActionLogs":[]},"transition":"_success"},"started":1599057010511,"status":"SUCCESS","subtasks":[],"type":"SINGLE"}},"operation":{"data":{"alias":"fetch-delivery-options-cb","actionFactory":"cb","actionConfig":{"circuitBreakerName":"delivery-cb","circuitBreakerOptions":{"maxRetries":1,"timeout":50},"logLevel":"error"},"doAction":{"alias":"fetch-delivery","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/mock/scenario/delayed","port":56104},"logLevel":"error"}}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-delivery-options-cb","logs":{"invocationCount":"2","error":"Exception: class io.vertx.circuitbreaker.TimeoutException. operation timeout"},"doActionLogs":[]},"transition":"_fallback"},"started":1599057010400,"status":"OTHER","subtasks":[],"type":"SINGLE"},{"finished":1599057010444,"id":"ba4b658f-65bb-43c1-9188-1964df0aefe6","label":"notify-analytics-cb","on":{"_fallback":{"finished":1599057010451,"id":"1d98741b-bd84-4f40-9102-3dee01c6d3a5","label":"notify-analytics-fallback","on":{},"operation":{"data":{"alias":"notify-analytics-fallback","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/placeholderFallback.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"notify-analytics-fallback","logs":{},"doActionLogs":[]},"transition":"_success"},"started":1599057010445,"status":"SUCCESS","subtasks":[],"type":"SINGLE"}},"operation":{"data":{"alias":"notify-analytics-cb","actionFactory":"cb","actionConfig":{"circuitBreakerName":"delivery-cb","logLevel":"error"},"doAction":{"alias":"notify-analytics","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"bodyJson":{"user-data-id":"{payload.fetch-user-info._result.id}"},"domain":"localhost","interpolateBody":true,"path":"/mock/scenario/analytics","port":62222},"httpMethod":"POST","logLevel":"error"}}},"factory":"action"},"response":{"errors":[],"log":{"alias":"notify-analytics-cb","logs":{"invocationCount":"1","error":"Exception: class io.knotx.fragments.action.library.exception.DoActionExecuteException. Action end up _error transition"},"doActionLogs":[{"duration":34,"success":false,"doActionLog":{"alias":"notify-analytics","logs":{"request":{"path":"/mock/scenario/analytics","requestHeaders":{"content-type":["application/json"]},"requestBody":"{\"user-data-id\":\"3214232\"}"},"response":{"httpVersion":"HTTP_1_1","statusCode":"500","statusMessage":"Server Error","headers":{"Transfer-Encoding":["chunked"],"Server":["Jetty(9.2.24.v20180105)"]},"trailers":{},"httpMethod":"POST","requestPath":"localhost:62222/mock/scenario/analytics"},"errors":[{"className":"java.io.IOException","message":"The service responded with unsuccessful status code: 500"}]},"doActionLogs":[]}}]},"transition":"_fallback"},"started":1599057010407,"status":"OTHER","subtasks":[],"type":"SINGLE"}],"type":"COMPOSITE"},"_custom":{"finished":0,"id":"c09334dc-b175-44b1-828f-c2f14b676207","label":"fetch-user-info-custom","on":{},"operation":{"data":{"alias":"fetch-user-info-custom","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/placeholderFallback.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{},"started":0,"status":"UNPROCESSED","subtasks":[],"type":"SINGLE"},"_error":{"finished":0,"id":"3f799a6e-f952-4d57-8c83-b816b6da32e1","label":"fetch-user-info-fallback","on":{},"operation":{"data":{"alias":"fetch-user-info-fallback","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/placeholderFallback.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{},"started":0,"status":"UNPROCESSED","subtasks":[],"type":"SINGLE"}},"operation":{"data":{"alias":"fetch-user-info","actionFactory":"http","actionConfig":{"endpointOptions":{"allowedRequestHeaders":["Content-Type"],"domain":"localhost","path":"/service/mock/userInfo.json","port":50796},"logLevel":"error"}},"factory":"action"},"response":{"errors":[],"log":{"alias":"fetch-user-info","logs":{},"doActionLogs":[]},"transition":"_success"},"started":1599057010384,"status":"SUCCESS","subtasks":[],"type":"SINGLE"},"startTime":1599057010384,"status":"SUCCESS"}</script>
      <div>
        <h2>Payment providers</h2>
        <ul>
          <li>
            <p>Payment provider: PayPal premium</p>
            <p>Payment URL: https://paypal-example.com/payment?id=1983247919hv9sa398f</p>
          </li>
          <li>
            <p>Payment provider: PayU</p>
            <p>Payment URL: https://payu-example.com/tr?id=afj08aw398gha0we9ge</p>
          </li>
          <li>
            <p>Payment provider: Credit Card</p>
            <p>Payment URL: https://cc-example.com/pay/19g8esry9se8rgyse90r8ug4</p>
          </li>
        </ul>
      </div>
      <!-- data-knotx-id="4991447d-8194-45a0-8cf2-b3f2a7e42d23" -->
    </div>
  </div>
</div>
</body>
</html>